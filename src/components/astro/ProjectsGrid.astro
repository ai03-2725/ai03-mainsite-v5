---
import { getEntries, type CollectionEntry } from "astro:content";
import type { ProjectGridStylesType } from "../../types";
import { Image } from 'astro:assets';
import { Icon } from "astro-icon/components";
import { getEntry } from "astro:content";
import { getCollection } from "astro:content";


interface Props {
  collection?: string;
  style: ProjectGridStylesType;
}

const { collection, style } = Astro.props;

let projectsList: CollectionEntry<'projects'>[] = []

if (collection) {
  const collectionData = await getEntry("project-collections", collection)
  projectsList = await getEntries<'projects'>(collectionData.data.projects)
} else {
  projectsList = (await getCollection('projects')).sort((a, b) => a.data.title.toLowerCase() > b.data.title.toLowerCase() ? 1 : -1);
}


let outermostContainerClasses: string[] = [
  "w-full"
];

let gridDivClasses: string[] = [
  "container", 
  "mx-auto", 
  "flex",
  "flex-row",
  "flex-wrap",
  "justify-center",
];

let projectDivClasses: string[] = [
  "w-full",
  // "md:w-1/2",
  // "xl:w-1/3",
  "lg:w-1/2",
  "aspect-[1.618]",
]

let projectCardDivClasses

switch (style) {
  case "light":
    projectDivClasses.push("p-2")
    break;

  case "dark":
    outermostContainerClasses.push("bg-zinc-800");
    break;

  default:
    break;
}

---

<div class={outermostContainerClasses.join(" ")}>
  <div class={gridDivClasses.join(" ")}>

    {projectsList.map((project) => 
      // Each project entry
      <div class={projectDivClasses.join(" ")}>

        {/* The inner visual div (the actual card bit) */}
        <div class="w-full h-full relative rounded-[3.75px] overflow-hidden">

          {/* Background image */}
          <img class="object-cover object-center w-full h-full absolute" src={project.data.cover.image} alt={project.data.cover.alt} />

          {/* Image overlay shadow div */}
          <div class="absolute bottom-0 left-0 w-full text-white bg-gradient-to-t from-[#00000080] h-1/3 p-5 flex flex-col-reverse">

            {/* Inner stack */}
            <div class="flex !flex-row items-end">

              {/* Project title */}
              <div class="md:pe-3">
                <p class="text-3xl">{project.data.title}</p>
              </div>

              {/* Project slogan */}
              <div class="grow">
                <p>{project.data.slogan}</p>
              </div>

              {/* Arrow button */}
              <div>
                {/* <a href="#"> */}
                  <div class="bg-white rounded-full w-12 aspect-square flex items-center justify-center">
                    <Icon name="ph:arrow-right" class="text-black text-[28px] pe-[1.5px]" />
                  </div>
                {/* </a> */}
              </div>
            </div>
          </div>

          {/* Link overlay */}
          <a href={`/projects/${project.slug}`} class="absolute w-full h-full z-0">
          </a>

        </div>
      </div>
    )}
  </div>
</div>
